# 협력자 자동 연결

스프링 컨테이너는 협력하는 빈 간의 관계를 자동 연결할 수 있다. `ApplicationContext`의 내용을 검사하여 스프링이 사용자의 빈에 대해 협력자(다른 빈)를 자동으로 해결하도록 할 수 있다. 자동 연결에는 다음과 같은 이점이 있다.

- 자동 연결을 사용하면 속성이나 생성자 인수를 지정할 필요성을 크게 줄일 수 있다. (이 장의 다른 곳에서 설명하는 빈 템플릿과 같은 다른 메커니즘도 이와 관련하여 유용하다.)
- 자동 연결은 객체가 진화함에 따라 설정을 업데이트할 수 있다. 예를 들어, 클래스에 의존성을 추가해야 하는 경우 설정을 수정할 필요 없이 해당 의존성을 자동으로 충족시킬 수 있다. 따라서 자동 연결은 개발 중에 특히 유용하며, 코드 기반 연결이 안정해질 때 명시적 연결로 전환하는 옵션을 배제하지 않는다.

XML 기반 설정 메타데이터([의존성 주입](https://github.com/iceprins/spring-framework-doc-kr/blob/main/1.%20IoC%20%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88/4.%20%EC%9D%98%EC%A1%B4%EC%84%B1/1.%20%EC%9D%98%EC%A1%B4%EC%84%B1%20%EC%A3%BC%EC%9E%85.md) 참조)를 사용하는 경우 `<bean/>` 요소의 `autowire` 속성을 사용하여 빈 정의에 대한 자동 연결 모드를 지정할 수 있다. 자동 연결 기능에는 네 가지 모드가 있다. 빈별로 자동 연결을 지정하여 어떤 빈을 자동 연결할지 선택할 수 있다. 다음 표에서는 네 가지 자동 연결 모드에 대해 설명한다.

| Mode          | Explanation                                                                                                                                                                           |
| ------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `no`          | (기본값) 자동 연결 없음. 빈 참조는 `ref` 요소로 정의해야 한다. 협력자를 명시적으로 지정하면 더 큰 제어권 및 명확성이 제공되므로, 대규모 배포의 경우 기본 설정을 변경하는 것은 권장되지 않는다. 어느 정도는 시스템의 구조를 문서화한다.                                             |
| `byName`      | 속성 이름별 자동 연결. 스프링은 자동 연결해야 하는 속성과 이름이 같은 빈을 찾는다. 예를 들어, 빈 정의가 이름으로 자동 연결하도록 설정되어 있고 `master` 속성이 포함된 경우(즉, `setMaster(..)` 메서드가 있는 경우) 스프링은 `master`라는 이름의 빈 정의를 찾아서 속성을 설정하는 데 사용한다. |
| `byType`      | 컨테이너에 해당 속성 타입의 빈이 정확히 하나만 존재하는 경우 속성이 자동 연결되도록 한다. 둘 이상 존재하면 치명적인 예외가 발생하며, 이는 해당 빈에 대해 `byType` 자동 연결을 사용할 수 없음을 나타낸다. 일치하는 빈이 없으면 아무 일도 일어나지 않는다(속성이 설정되지 않음).                     |
| `constructor` | `byType`과 유사하지만 생성자 인수에 적용된다. 컨테이너에 생성자 인수 타입의 빈이 정확히 하나가 아닌 경우 치명적인 오류가 발생한다.                                                                                                        |

`byType` 또는 `contructor` 자동 연결 모드를 사용하면 배열과 타입 지정된 컬렉션을 연결할 수 있다. 이러한 경우 컨테이너 내에서 예상 타입과 일치하는 모든 자동 연결 후보가 의존성을 충족하기 위해 제공된다. 예상 키 타입이 `String`인 경우 강력하게 타입 지정된 `Map` 인스턴스를 자동 연결할 수 있다. 자동 연결된 `Map` 인스턴스의 값은 예상 타입과 일치하는 모든 빈 인스턴스로 구성되며, `Map` 인스턴스의 키에는 해당 빈 이름이 포함된다.

## 자동 연결의 한계 및 단점

자동 연결은 프로젝트 전체에서 일관되게 사용할 때 가장 잘 작동한다. 전반적으로 자동 연결을 사용하지 않는 경우, 개발자가 한두 개의 빈 정의만 연결하는 데 자동 연결을 사용하면 혼란스러울 수 있다.

자동 연결의 한계와 단점을 고려하라.

- `property` 및 `contructor-arg` 설정의 명시적 의존성은 항상 자동 연결보다 우선한다. 원시 타입, `String`, `Class`(및 이러한 단순 속성의 배열)와 같은 단순 속성은 자동 연결할 수 없다. 이 제한은 의도적으로 설정된 것이다.
- 자동 연결은 명시적 연결보다 정확도가 떨어진다. 하지만 앞의 표에서 언급했듯이, 스프링은 예기치 않은 결과를 초래할 수 있는 모호한 경우에 추측을 피하기 위해 주의를 기울인다. 스프링으로 관리되는 객체 간의 관계는 더 이상 명시적으로 기록되지 않는다.
- 스프링 컨테이너에서 문서를 생성할 수 있는 도구에서는 연결 정보를 사용할 수 없을 수도 있다.
- 컨테이너 내의 여러 빈 정의가 setter 메서드 또는 생성자 인수에 의해 지정된 타입과 일치하여 자동 연결될 수 있다. 배열, 컬렉션 또는 `Map` 인스턴스의 경우 이것이 반드시 문제가 되는 것은 아니다. 그러나 단일 값을 기대하는 의존성의 경우 이러한 모호성이 임의로 해결되지 않는다. 고유한 빈 정의를 사용할 수 없는 경우 예외가 발생한다.

후자의 시나리오에서는 몇 가지 옵션이 있다.

- 자동 연결을 포기하고 명시적 연결을 사용하라.
- 다음 섹션에 설명된 대로 `autowire-candidate` 속성을 `false`로 설정하여 빈 정의에 대한 자동 연결을 피하라.
- `<bean/>` 요소의 `primary` 속성을 `true`로 설정하여 단일 빈 정의를 기본 후보로 지정하라.
- 어노테이션 기반 컨테이너 설정에 설명된 대로 어노테이션 기반 설정에서 사용할 수 있는 보다 세분화된 제어를 구현하라.

## 자동 연결에서 빈 제외하기

빈 단위로 자동 연결에서 빈을 제외할 수 있다. 스프링의 XML 형식에서 `<bean/>` 요소의 `autowire-candidate` 속성을 `false`로 설정한다. 컨테이너는 해당 특정 빈 정의를 자동 연결 인프라에서 사용할 수 없게 만든다(`@Autowired`와 같은 어노테이션 스타일 설정 포함).

> ### 주의
> 
> `autowire-candidate` 속성은 타입 기반 자동 연결에만 영향을 주도록 설계되었다. 지정된 빈이 자동 연결 후보로 표시되지 않아도 해결되는, 이름에 의한 명시적 참조에는 영향을 미치지 않는다. 따라서 이름별 자동 연결은 이름이 일치하는 경우 빈을 주입한다.

빈 이름에 대한 패턴 매칭을 기반으로 자동 연결 후보를 제한할 수도 있다. 최상위 `<beans/>` 요소는 `default-autowire-candidates` 속성 내에서 하나 이상의 패턴을 허용한다. 예를 들어, 이름이 `Repository`로 끝나는 모든 빈으로 자동 연결 후보 상태를 제한하려면 `*Repository` 값을 제공한다. 여러 패턴을 제공하려면 쉼표로 구분된 목록으로 정의해야 한다. 빈 정의의 `autowire-candidate` 속성에 대한 `true` 또는 `false`의 명시적 값이 항상 우선한다. 이러한 빈의 경우 패턴 매칭 규칙이 적용되지 않는다.

이러한 기술은 자동 연결을 통해 다른 빈에 주입되지 않으려는 빈에 유용하다. 자동 연결을 사용하여 제외된 빈이 자체적으로 자동 연결을 사용하여 설정할 수 없다는 의미는 아니다. 오히려 해당 빈 자체는 다른 빈에 자동 연결될 후보가 아님을 의미한다.
